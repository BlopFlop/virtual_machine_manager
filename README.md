# test_mts

## О проекте
Реализован сервер, обрабатывающий команды от клиентов и внутренние команды.
Создан класс VirtualMachine, представляющий виртуальную машину с параметрами: ID, RAM, CPU, жесткие диски (с уникальными ID).
Реализована аутентификация клиентов при подключении.
Добавлены методы:
- Добавление новой ВМ в базу данных.
- Вывод списка подключенных, авторизованных и всех когда-либо подключаемых ВМ.
- Выход из авторизованной ВМ.
- Обновление данных авторизованной ВМ.
- Вывод списка всех жестких дисков с параметрами и привязкой к ВМ.
Клиентская часть:
- Реализованы клиенты, имитирующие виртуальные машины, с возможностью подключения к серверу и выполнения команд.
База данных:
- Использована PostgreSQL для хранения данных.
- Все запросы выполнены с использованием asyncpg без ORM.

**Команды:**
- Как у сервера так и у клиента есть команда для получения помощи /help
 
## Стек
- Python 3.11.2
- asyncpg
- PostgreSQL

## Настройка

### Настройка после клонирования репозитория

После клонирования репозиторий имеет следующую структуру:

```
test_mts
│
├── infta/     # Каталог с файлами инфраструктуры
│   └── env.example     # Пример конфигурационного файла
│
├───server/
│   ├───core/     # Настройки сервера
│   ├───migrations/ # Скрипт миграции
│   ├───queries/ # sql запросы
│   ├───services/ # логика
│   ├───tests/ # тесты
│   │
│   ├── main.py     # Точка входа в приложение
│   ├── migrate.py     # Миграции
│   ├── models.py     # Модели
│   ├── outputs.py     # Вывод данных в терминал
│   ├── repository.py     # Crud операции
│   ├── utils.py     # Вспомогательные программы
│   ├── pytest.ini       # настройки pytest
│
├───client/
│   ├── main.py     # Точка входа в приложение
│   ├── utils.py     # Вспомогательные программы
│
└── README.md       # Этот файл
```
**Устанавливаем и активируем виртуальное окружение**
```
Добавить папку server и clients в рабочую директорию
```
```
Перейти в папку server и clients
```
cd server
cd clients
```
```shell
python3.11 -m venv .venv
source .venv/bin/activate
```

Устанавливаем зависимости
```shell
pip install -r requirements.txt
```
#Запуск проекта
Пример .env
```
#  database
DB="test_task_db"
DB_USER="postgress"  # Заменить
DB_PASSWORD="test"  # Заменить
DB_SERVER="test_task" # Изменить на название контейнера с БД в Docker Compose
DB_PORT="5434"

#  test database
TEST_DB="testdb"
TEST_DB_USER="postgress"  # Заменить
TEST_DB_PASSWORD="test"  # Заменить
TEST_DB_SERVER="localhost"  # Изменить на название контейнера развернутой тестовой бд
TEST_DB_PORT="5435"

```
Применить миграции из рабочей директории server
```
python migrate.py
```
Запустить проект server и client через терминал командой
```
python main.py
```
